function handleResize(){Stickyfill.add(d3.select(".sticky").node()),windowW=window.innerWidth,windowH=window.innerHeight,large_screen=!1,medium_screen=!1,small_screen=!1,margin={top:0,right:0,bottom:0,left:0},c1m={top:12,right:25,bottom:30,left:25},c1D={w:0,h:0,m:8},scatterM={top:12,right:25,bottom:30,left:25},scatterD={w:0,h:0,m:8},windowW>=1025?large_screen=!0:windowW>=650?medium_screen=!0:windowW<650&&(small_screen=!0),small_screen?(margin.left=0,margin.right=0,c1m.right=15,c1D.w=windowW-16-c1m.left-c1m.right,c1D.h=.66*windowW-c1m.top-c1m.bottom,scatterM.right=15,scatterD.w=windowW-16-scatterM.left-scatterM.right,scatterD.h=400):(margin.left=.125*windowW-8,margin.right=.125*windowW-8,c1D.w=.75*windowW-c1m.left-c1m.right,c1D.h=.75*windowW*.66-c1m.top-c1m.bottom,scatterD.w=.75*windowW-scatterM.left-scatterM.right,scatterD.h=400),w=$(".chart1").width()-c1m.right,c1x=d3.scaleLinear().domain([1870,2018]).range([75,w]),d3.selectAll(".searchM,.c1seasonM").transition().duration(500).attr("x1",function(t){return c1x(t.season+.5)}).attr("x2",function(t){return c1x(t.season+1.5)}),d3.selectAll(".searchSeason,.c1season").transition().duration(500).attr("x1",function(t){return c1x(t.season)}).attr("x2",function(t){return c1x(t.season+1.1)}),d3.selectAll(".searchData,.c1seasonD").transition().duration(200).style("opacity",0).attr("x1",function(t){return c1x(t)}).attr("x2",function(t){return c1x(t+.25)}).transition().duration(250).style("opacity",1),d3.selectAll(".c1label").transition().duration(500).attr("x",function(t){return c1x(t.seasons[0].season)}),d3.selectAll(".c1tickmain,.c1tick").attr("x1",function(t){return c1x(t)}).attr("x2",function(t){return c1x(t)}),d3.selectAll(".c1axis").attr("x",function(t){return c1x(t)}),d3.selectAll(".c1axisRect").attr("x",function(t){return c1x(t)-15})}function loadData(){queue().defer(d3.csv,"data/metros.csv").defer(d3.json,"data/seasons.json").defer(d3.csv,"data/pops.csv").defer(d3.json,"data/tlq.json").await(processData),ipLookUp()}function processData(t,e,a,r,n){handleResize(),window.addEventListener("resize",handleResize),findClosest(e),drawTLQ(n),drawChart1(e,a),drawChart2(e)}function drawTLQ(t){function e(t,e,a,r){t.forEach(function(t){for(var n=0,s=0;s<t[r].length;s++)t[r][s]>=e&&t[r][s]<=a&&(n+=1);t.count=n}),t=t.filter(function(t){return t.count>0}),d3.selectAll(".s1annT, .s1annST").transition().style("opacity",0).remove(),scatterY.range([scatterD.h,0]).domain([0,80]),scatterX=d3.scaleLinear().range([0,scatterD.w]).domain([0,22e6]);var n=d3.axisBottom(scatterX).tickSize(0).tickFormat(d3.format(".2s")).tickValues([2e6,4e6,6e6,8e6,1e7,12e6,14e6,16e6,18e6,2e7,22e6]);u.select(".x.axis").transition().duration(250).attr("transform","translate(0,"+scatterD.h+")").call(n),u.select(".y.axis").transition().duration(250).style("opacity",1),u.select(".x.axis .label").text("Population").attr("dy",0).attr("y",30).attr("x",scatterD.w).attr("dx",0);var o=u.selectAll(".dot").data(t,function(t){return t.metro}),l=u.selectAll(".s1label").data(t),i=u.selectAll(".s1labelBG").data(t);p.selectAll("path").remove(),p.selectAll("path").data(d(t).polygons()).enter().append("path").attr("d",function(t){return t?"M"+t.join("L")+"Z":null}).style("pointer-events","all").on("mouseover",s).on("mouseout",c),o.enter().append("circle").attr("class","dot").attr("id",function(t){return"scatterDot-"+camelize(t.metro)}).attr("cy",scatterY(0)).attr("cx",function(t){return scatterX(t.population)}).style("opacity",0).merge(o).transition().duration(250).attr("r",3.5).style("opacity",.5).attr("cy",function(t){return scatterY(t.count)}).attr("cx",function(t){return scatterX(t.population)}),o.exit().transition().duration(250).attr("cy",scatterY(0)).style("opacity",0).remove(),i.enter().append("text").attr("dy",15).text(function(t){return t.metro}).style("opacity",0).merge(i).attr("class","s1labelBG").attr("id",function(t){return"s1labelBG-"+camelize(t.metro)}).attr("x",function(t){return scatterX(t.population)}).attr("y",function(t){return scatterY(t.count)}),i.exit().remove(),l.enter().append("text").attr("dy",15).style("opacity",0).merge(l).text(function(t){return t.metro}).attr("class","s1label").attr("id",function(t){return"s1label-"+camelize(t.metro)}).attr("x",function(t){return scatterX(t.population)}).attr("y",function(t){return scatterY(t.count)}),l.exit().remove()}function a(t,e,a,r){function o(o){0===o?u.select("#scatterDot-greenBayWI").style("fill","#E00000").transition().duration(500).style("opacity",1).attr("cx",function(t){return scatterX(t.population)}).attr("cy",function(t){return scatterY(t.count)}).attr("r",4):1===o?(scatterY.range([.75*scatterD.h,.25*scatterD.h]).domain([0,20]),i.tickFormat(function(t){return 20===t?t+" titles":t}).tickSize(-scatterD.w),u.select(".y.axis").transition().duration(250).call(i),u.select(".x.axis").transition().duration(250).attr("transform","translate(0,"+.75*scatterD.h+")"),u.selectAll(".dot").transition().duration(250).attr("cx",function(t){return scatterX(t.population)}).attr("cy",function(t){return scatterY(t.count)}),u.selectAll(".s1annT, .s1annST").attr("y",function(t){return scatterY(t.titles)}),u.selectAll("#s1ann-pop-greenBayWI").style("opacity",.25).attr("x1",function(t){return scatterX(t.population)}).attr("x2",function(t){return scatterX(t.population)}).attr("y1",scatterY(0)).attr("y2",scatterY(0)).transition().duration(250).attr("y1",scatterY(0)).attr("y2",function(t){return scatterY(t.titles)}).attr("x1",function(t){return scatterX(t.population)}).attr("x2",function(t){return scatterX(t.population)}).transition().duration(500).style("opacity",0),u.selectAll("#s1ann-count-greenBayWI").style("opacity",.25).attr("x1",scatterX(0)).attr("x2",scatterX(0)).attr("y1",scatterY(0)).attr("y2",scatterY(0)).transition().duration(250).attr("y1",function(t){return scatterY(t.titles)}).attr("y2",function(t){return scatterY(t.titles)}).attr("x1",scatterX(0)).attr("x2",function(t){return scatterX(t.population)}).transition().duration(500).style("opacity",0),u.selectAll("#s1ann-greenBayWI, #s1annST-greenBayWI").transition().duration(250).delay(500).style("opacity",1)):2===o?(scatterY.range([scatterD.h,0]).domain([0,80]),scatterX.range([0,scatterD.w]).domain([0,22e6]),i.tickFormat(function(t){return 80===t?t+" titles":t}).tickValues([10,20,30,40,50,60,70,80]),scatterX=d3.scaleLinear().range([0,scatterD.w]).domain([0,22e6]),l=d3.axisBottom(scatterX).tickSize(0).tickFormat(d3.format(".2s")).tickValues([2e6,4e6,6e6,8e6,1e7,12e6,14e6,16e6,18e6,2e7,22e6]),u.select(".y.axis").transition().duration(250).call(i),u.select(".x.axis").transition().duration(250).attr("transform","translate(0,"+scatterD.h+")").call(l),u.selectAll(".dot").transition().duration(250).attr("cx",function(t){return scatterX(t.population)}).attr("cy",function(t){return scatterY(t.count)}),u.selectAll(".s1annT, .s1annST").transition().duration(250).attr("y",function(t){return scatterY(t.titles)}).attr("x",function(t){return scatterX(t.population)}),u.selectAll("#scatterDot-newYorkMetroArea, #scatterDot-greaterBostonMA, #scatterDot-edmontonAB").style("fill","#E00000").attr("cx",scatterX(0)).attr("cy",scatterY(0)).attr("r",4).transition().duration(1e3).style("opacity",1).attr("cx",function(t){return scatterX(t.population)}).attr("cy",function(t){return scatterY(t.count)}),u.selectAll(".s1ann-pop:not(#s1ann-pop-greenBayWI)").style("opacity",.25).attr("x1",scatterX(0)).attr("x2",scatterX(0)).attr("y1",scatterY(0)).attr("y2",scatterY(0)).transition().duration(1e3).attr("y1",scatterY(0)).attr("y2",function(t){return scatterY(t.titles)}).attr("x1",function(t){return scatterX(t.population)}).attr("x2",function(t){return scatterX(t.population)}).transition().duration(500).style("opacity",0),u.selectAll(".s1ann-count:not(#s1ann-count-greenBayWI)").style("opacity",.25).attr("x1",scatterX(0)).attr("x2",scatterX(0)).attr("y1",scatterY(0)).attr("y2",scatterY(0)).transition().duration(1e3).attr("y1",function(t){return scatterY(t.titles)}).attr("y2",function(t){return scatterY(t.titles)}).attr("x1",scatterX(0)).attr("x2",function(t){return scatterX(t.population)}).transition().duration(500).style("opacity",0),u.selectAll(".s1annT, .s1annST").transition().duration(250).delay(1250).style("opacity",1)):3===o?(scatterY.range([scatterD.h,0]).domain([0,80]),scatterX=d3.scaleLinear().range([0,scatterD.w]).domain([0,22e6]),u.selectAll(".dot").transition().style("opacity",.5).attr("r",3.5),u.selectAll(".s1label, .s1labelBG").attr("x",function(t){return scatterX(t.population)}).attr("y",function(t){return scatterY(t.count)}),p.selectAll("path").data(d(t).polygons()).enter().append("path").attr("d",function(t){return t?"M"+t.join("L")+"Z":null}).style("pointer-events","all").on("mouseover",s).on("mouseout",c)):4===o?(document.getElementById("sw_pro").checked=!0,d3.selectAll(".s1annT, .s1annST").transition().style("opacity",0).remove(),d3.selectAll(".guide").transition().style("opacity",0),p.selectAll("path").remove(),n(t,e,a,r)):5===o?(u.select("#scatterDot-chicagoIL").transition().style("opacity",".2"),u.select("#scatterDot-newYorkMetroArea").transition().style("fill","#e00000").style("opacity","1"),u.selectAll("#s1label-chicagoIL, #s1labelBG-chicagoIL").transition().style("opacity",0),u.selectAll("#s1label-newYorkMetroArea, #s1labelBG-newYorkMetroArea").transition().style("opacity",1)):6===o?(u.select("#scatterDot-newYorkMetroArea").transition().style("opacity",".2"),u.select("#scatterDot-greenBayWI").transition().style("fill","#e00000").style("opacity","1"),u.selectAll("#s1label-newYorkMetroArea, #s1labelBG-newYorkMetroArea").transition().style("opacity",0),u.selectAll("#s1label-greenBayWI, #s1labelBG-greenBayWI").transition().style("opacity",1)):7===o&&(u.selectAll(".dot").transition().style("opacity",".5").style("fill","#000"),u.selectAll("#s1label-greenBayWI, #s1labelBG-greenBayWI").transition().style("opacity",0))}scatterX=d3.scaleLinear().range([0,scatterD.w]),scatterY=d3.scaleLinear().range([scatterD.h/2,scatterD.h/2]);var l=d3.axisBottom(scatterX).tickSize(0).tickFormat(d3.format(".2s")).tickValues([1e5,2e5,3e5,4e5,5e5]),i=d3.axisLeft(scatterY).tickSize(0).tickFormat(function(t){return""}).tickValues([5,10,15,20]);t.forEach(function(t){for(var n=0,s=0;s<t[r].length;s++)t[r][s]>=e&&t[r][s]<=a&&(n+=1);t.count=n}),t=t.filter(function(t){return t.count>0});var y=[{metro:"Green Bay, WI",population:320025,titles:14,proTLQ:14.34},{metro:"New York Metro Area, NY",population:20320876,titles:57,proTLQ:.92},{metro:"Greater Boston, MA",population:4836531,titles:37,proTLQ:2.51},{metro:"Edmonton, AB",population:1321426,titles:19,proTLQ:4.71}];scatterX.domain([0,5e5]).nice(),scatterY.domain(d3.extent(t,function(t){return t.count})).nice(),u.append("g").attr("class","x axis").attr("transform","translate(0,"+scatterD.h/2+")").call(l).append("text").attr("class","label").attr("x",scatterD.w).attr("y",30).style("text-anchor","middle").text("Population"),u.append("g").attr("class","y axis").call(i),u.selectAll(".dot").data(t).enter().append("circle").attr("class","dot").attr("id",function(t){return"scatterDot-"+camelize(t.metro)}).attr("r",3.5).attr("cx",function(t){return scatterX(0)}).attr("cy",function(t){return scatterY(0)}).style("opacity",0),u.selectAll(".s1labelBG").data(t).enter().append("text").attr("class","s1labelBG").attr("id",function(t){return"s1labelBG-"+camelize(t.metro)}).attr("dy",15).style("opacity",0).text(function(t){return t.metro}),u.selectAll(".s1label").data(t).enter().append("text").attr("class","s1label").attr("id",function(t){return"s1label-"+camelize(t.metro)}).attr("dy",15).style("opacity",0).text(function(t){return t.metro}),u.selectAll(".s1annT").data(y).enter().append("text").attr("class","s1annT").attr("id",function(t){return"s1ann-"+camelize(t.metro)}).attr("x",function(t){return scatterX(t.population)}).attr("y",function(t){return scatterY(t.titles)}).attr("dy",function(t){return"Edmonton, AB"===t.metro?-30:25}).style("opacity",0).text(function(t){return t.metro}),u.selectAll(".s1annST").data(y).enter().append("text").attr("class","s1annST").attr("id",function(t){return"s1annST-"+camelize(t.metro)}).attr("x",function(t){return scatterX(t.population)}).attr("y",function(t){return scatterY(t.titles)}).attr("dy",function(t){return"Edmonton, AB"===t.metro?-15:40}).style("opacity",0).text(function(t){return"("+t.proTLQ+" LQ)"}),u.selectAll(".s1ann-pop").data(y).enter().append("line").attr("class","s1ann s1ann-pop").attr("id",function(t){return"s1ann-pop-"+camelize(t.metro)}).attr("x1",function(t){return scatterX(t.population)}).attr("x2",function(t){return scatterX(t.population)}).attr("y1",function(t){return scatterY(t.titles)}).attr("y2",function(t){return scatterY(t.titles)}).style("opacity",0),u.selectAll(".s1ann-count").data(y).enter().append("line").attr("class","s1ann s1ann-count").attr("id",function(t){return"s1ann-count-"+camelize(t.metro)}).attr("x1",function(t){return scatterX(t.population)}).attr("x2",function(t){return scatterX(t.population)}).attr("y1",function(t){return scatterY(t.titles)}).attr("y2",function(t){return scatterY(t.titles)}).style("opacity",0),enterView({selector:stepSel.nodes(),offset:.2,enter:function(t){o(+d3.select(t).attr("data-index"))},once:!1})}function r(t,e,a,r){var n=0,o=0;t.forEach(function(t){for(var n=0,s=0;s<t[r].length;s++)t[r][s]>=e&&t[r][s]<=a&&(n+=1);t.count=n}),t=t.filter(function(t){return t.count>0}),t.forEach(function(t){n+=t.population,o+=t.count}),t.forEach(function(t){t.tlq=t.count/t.population/(o/n),t.tlq<=0&&(t.tlq=0)}),t=t.sort(function(t,e){return d3.descending(t.tlq,e.tlq)});var l=d3.extent(t,function(t){return t.tlq});scatterX.rangeRound([0,scatterD.w/2,scatterD.w]).domain([l[0],1,l[1]]),radius.domain(d3.extent(t,function(t){return t.count}));var i=d3.axisBottom(scatterX).tickFormat(function(t){return d3.format(".1r")(t)+"x"}).tickValues([.1,.5,1,10,20,100]).tickSize(10,0);u.select(".x.axis").transition().duration(250).call(i);var d=d3.forceSimulation(t).force("x",d3.forceX(function(t){return scatterX(t.tlq)}).strength(1)).force("y",d3.forceY(scatterD.h/2)).force("collide",d3.forceCollide(4).radius(function(t){return 1.1*radius(t.count)})).stop();console.log(t),p.selectAll("path").remove(),p.selectAll("path").data(y(t).polygons()).enter().append("path").attr("d",function(t){return t?"M"+t.join("L")+"Z":null}).style("pointer-events","all").on("mouseover",s).on("mouseout",c);var f=u.selectAll(".dot").data(t,function(t){return t.metro});f.enter().append("circle").attr("cy",scatterY(0)).attr("cx",0).attr("r",3.5).style("opacity",0).merge(f).attr("class","dot").attr("id",function(t){return"scatterDot-"+camelize(t.metro)}).transition().duration(250).delay(100).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",function(t){return radius(t.count)}).style("opacity",.5),f.exit().transition().duration(250).attr("cy",scatterD.h/2).style("opacity",0).remove();var h=u.selectAll(".s1label").data(t,function(t){return t.metro});h.enter().append("text").style("opacity",0).merge(h).text(function(t){return t.metro+" (TLQ: "+t.tlq.toFixed(2)+")"}).attr("class","s1label").attr("id",function(t){return"s1label-"+camelize(t.metro)}).attr("dy",function(t){return radius(t.count)+15}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).style("opacity",0),h.exit().remove();var x=u.selectAll(".s1labelBG").data(t,function(t){return t.metro});x.enter().append("text").style("opacity",0).merge(x).text(function(t){return t.metro+" (TLQ: "+t.tlq.toFixed(2)+")"}).attr("class","s1labelBG").attr("id",function(t){return"s1labelBG-"+camelize(t.metro)}).attr("dy",function(t){return radius(t.count)+15}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).style("opacity",0),x.exit().remove()}function n(t,e,a,r){var n=0,o=0;t.forEach(function(t){for(var n=0,s=0;s<t[r].length;s++)t[r][s]>=e&&t[r][s]<=a&&(n+=1);t.count=n}),t=t.filter(function(t){return t.count>0}),t.forEach(function(t){n+=t.population,o+=t.count}),t.forEach(function(t){t.tlq=t.count/t.population/(o/n),t.tlq<=0&&(t.tlq=0)}),t=t.sort(function(t,e){return d3.descending(t.tlq,e.tlq)}),swarmX=d3.scaleLog().rangeRound([0,scatterD.w/2,scatterD.w]).domain([.056877221441297185,1,20]),radius.domain(d3.extent(t,function(t){return t.count}));var l=d3.axisBottom(swarmX).tickFormat(function(t){return d3.format(".1r")(t)+"x"}).tickValues([.1,.5,1,5,10,20]).tickSize(10,0);u.select(".x.axis").transition().duration(250).attr("transform","translate(0,"+scatterD.h/2+")").call(l),u.select(".y.axis").transition().duration(250).style("opacity",0),u.selectAll(".x.axis .tick line").transition().delay(250).attr("y2",function(t){return 1===t?75:.5===t||5===t?40:10===t||.1===t?20:5}),u.selectAll(".x.axis .tick text").transition().delay(250).attr("dy",15).attr("y",function(t){return 1===t?75:.5===t||5===t?40:10===t||.1===t?20:5}),u.select(".x.axis .label").text("Title Location Quotient (TLQ)").attr("dy",100).attr("dx",10);var i=d3.forceSimulation(t).force("x",d3.forceX(function(t){return swarmX(t.tlq)}).strength(1)).force("y",d3.forceY(scatterD.h/2)).force("collide",d3.forceCollide(4).radius(function(t){return 1.1*radius(t.count)})).stop(),d=u.selectAll(".dot").data(t,function(t){return t.metro});d.enter().append("circle").attr("cy",scatterY(0)).attr("cx",0).attr("r",3.5).style("opacity",0).merge(d).attr("class","dot").attr("id",function(t){return"scatterDot-"+camelize(t.metro)}).transition().duration(250).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",function(t){return radius(t.count)}).style("opacity",function(t){return"Chicago, IL"===t.metro?1:.05}).style("fill",function(t){return"Chicago, IL"===t.metro?"#E00000":"#000"}),d.exit().transition().duration(250).attr("cy",scatterY(0)).style("opacity",0).remove();var f=u.selectAll(".s1label").data(t,function(t){return t.metro});f.enter().append("text").style("opacity",0).merge(f).text(function(t){return t.metro+" (TLQ: "+t.tlq.toFixed(2)+")"}).attr("class","s1label").attr("id",function(t){return"s1label-"+camelize(t.metro)}).attr("dy",function(t){return radius(t.count)+15}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).style("opacity",function(t){return"Chicago, IL"===t.metro?1:0}),f.exit().remove();var h=u.selectAll(".s1labelBG").data(t,function(t){return t.metro});h.enter().append("text").style("opacity",0).merge(h).text(function(t){return t.metro+" (TLQ: "+t.tlq.toFixed(2)+")"}).attr("class","s1labelBG").attr("id",function(t){return"s1labelBG-"+camelize(t.metro)}).attr("dy",function(t){return radius(t.count)+15}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).style("opacity",function(t){return"Chicago, IL"===t.metro?1:0}),h.exit().remove(),p.selectAll("path").data(y(t).polygons()).enter().append("path").attr("d",function(t){return t?"M"+t.join("L")+"Z":null}).style("pointer-events","all").on("mouseover",s).on("mouseout",c);for(var x=0;x<120;++x)i.tick()}function s(t,e){var a=camelize(t.data.metro),r=d3.selectAll("#scatterDot-"+a);d3.selectAll(".dot:not(#scatterDot-"+a+")").transition().style("opacity",.25),r.transition().style("opacity",.75),d3.selectAll(".s1annT, .s1annST").transition().style("opacity",0),d3.selectAll("#s1label-"+a+", #s1labelBG-"+a).transition().style("opacity",1),void 0===t.data.tlq&&(u.append("line").attr("class","s1ann guide").attr("x1",scatterX(t.data.population)).attr("x2",scatterX(t.data.population)).attr("y1",scatterY(0)).attr("y2",scatterY(t.data.count)).style("stroke","#000").style("opacity",0).style("pointer-events","none").transition().duration(200).style("opacity",.25),u.append("line").attr("class","s1ann guide").attr("x1",scatterX(0)).attr("x2",scatterX(t.data.population)).attr("y1",scatterY(t.data.count)).attr("y2",scatterY(t.data.count)).style("stroke","#000").style("opacity",0).style("pointer-events","none").transition().duration(200).style("opacity",.25),u.append("rect").attr("class","guide").attr("x",scatterX(t.data.population)-15).attr("y",scatterY(0)+1).attr("height",12).attr("width",30).style("fill","white").style("opacity",0).transition().duration(200).style("opacity",1),u.append("text").attr("class","s1guide guide").attr("x",scatterX(t.data.population)).attr("y",scatterY(0)).attr("dy",10).style("fill","#000").style("opacity",0).text(d3.format(".2s")(t.data.population)).transition().duration(200).style("opacity",.25),u.append("rect").attr("class","guide").attr("x",scatterX(0)-30).attr("y",scatterY(t.data.count)-4).attr("height",12).attr("width",30).style("fill","white").style("opacity",0).transition().duration(200).style("opacity",1),u.append("text").attr("class","s1guide guide").attr("x",scatterX(0)-2).attr("y",scatterY(t.data.count)).attr("dy",3).style("text-anchor","end").style("fill","#000").style("opacity",0).text(t.data.count).transition().duration(200).style("opacity",.25))}function c(t,e){var a=camelize(t.data.metro);d3.selectAll(".dot").transition().style("opacity",.5),d3.selectAll(".s1annT, .s1annST").transition().style("opacity",1),d3.selectAll("#s1label-"+a+", #s1labelBG-"+a).transition().style("opacity",0),d3.selectAll(".guide").transition().duration(200).style("opacity",0).remove()}var o=1870,l=2018,i="proYears",u=d3.select(".scatter").append("svg").attr("class","scatter").attr("width",scatterD.w+scatterM.left).attr("height",scatterD.h+scatterM.top+scatterM.bottom).append("g").attr("transform","translate("+scatterM.left+","+scatterM.top+")");$(".leagueToggleVS").change(function(){var a=$('input[name="switch1"]:checked').val();e(t,1870,l,a)}),$(".leagueToggleTLQ").change(function(){var e=$('input[name="switch2"]:checked').val();r(t,1870,l,e)});var d=d3.voronoi().x(function(t){return scatterX(t.population)}).y(function(t){return scatterY(t.count)}).extent([[0,0],[scatterD.w,scatterD.h]]),y=d3.voronoi().x(function(t){return t.x}).y(function(t){return t.y}).extent([[0,0],[scatterD.w,scatterD.h]]),p=u.append("g").attr("class","voronoi");a(t,1870,l,i)}function drawChart1(t,e){function a(t,e,a,r,n){var s=t.sort(function(t,e){return d3.ascending(t[a][0].season,e[a][0].season)}).slice(0,r),l=e.filter(function(t){return t.seasonArray.length>0}).sort(function(t,e){return d3.ascending(t.seasonArray[0],e.seasonArray[0])}).slice(0,r);if(n)var u=d3.select(".chart1").append("svg").attr("class","c1svg").attr("height",c*r).attr("width",o);else var u=d3.select(".c1svg").attr("height",c*r);u.call(tip),i.domain(d3.range(r)).rangeRound([0,r*c]),d3.selectAll(".c1tickmain").transition().duration(250).attr("y2",i(r-1)+c),u.selectAll(".c1label").data(s).enter().append("text").attr("class","c1label").attr("id",function(t,e){return"c1l-"+e}).attr("x",function(t){return c1x(t.seasons[0].season)}).attr("y",function(t,e){return i(e)+c/2}).attr("dy",3).attr("dx",-6).style("text-anchor","end").text(function(t){return t.metro}).style("opacity",0).transition().duration(500).delay(function(t,e){return 10*(e-(r-25))}).style("opacity",1),u.selectAll(".c1seasonG").data(s).enter().append("g").attr("class","c1seasonG").each(function(t,e){var a=e;d3.select(this).selectAll(".c1season").data(t.seasons).enter().append("line").attr("class","c1season sl-"+a).attr("x1",function(t){return c1x(s[a].seasons[0].season)}).attr("x2",function(t){return c1x(s[a].seasons[0].season)}).attr("y1",function(t){return i(a)+c/2}).attr("y2",function(t){return i(a)+c/2}).transition().duration(750).delay(10*(a-(r-25))).attr("x1",function(t){return c1x(t.season)}).attr("x2",function(t){return c1x(t.season+1.1)}).style("stroke-linecap","round").style("stroke","#444").style("stroke-width",5).each(function(t){var e=i(a)+c/2,n=i(a)+c/2,s=i(a)+c/2,o=5;t.titles.length>0&&t.finals.length>0?(s=i(a)+(c/2-1.25),n=i(a)+(c/2+1.25),o=2.5):t.finals.length>0&&t.finalFours.length>0?(e=i(a)+(c/2-1.25),n=i(a)+(c/2+1.25),o=2.5):t.finals.length>0&&t.finalFours.length>0&&t.titles.length>0&&(e=i(a)+(c/2-1.6667),n=i(a)+c/2,s=i(a)+(c/2+1.6667),o=1.6667);for(var l=0;l<t.finalFours.length;l++)u.selectAll("c1seasonFF").data([t.season]).enter().append("line").attr("class","c1seasonD c1seasonFF").attr("x1",function(t){return c1x(t)}).attr("x2",function(t){return c1x(t+.25)}).attr("y1",e).attr("y2",e).style("opacity",0).transition().duration(500).delay(700+15*(a-(r-25))).style("opacity",1).style("stroke-linecap","round").style("stroke",cEvents.finalFour).style("stroke-width",o);for(var l=0;l<t.finals.length;l++)u.selectAll("c1seasonF").data([t.season]).enter().append("line").attr("class","c1seasonD c1seasonF").attr("x1",function(t){return c1x(t)}).attr("x2",function(t){return c1x(t+.25)}).attr("y1",n).attr("y2",n).style("opacity",0).transition().duration(500).delay(700+15*(a-(r-25))).style("opacity",1).style("stroke-linecap","round").style("stroke",cEvents.final).style("stroke-width",o);for(var l=0;l<t.titles.length;l++)u.selectAll("c1seasonT").data([t.season]).enter().append("line").attr("class","c1seasonD c1seasonT").attr("x1",function(t){return c1x(t)}).attr("x2",function(t){return c1x(t+.25)}).attr("y1",s).attr("y2",s).style("opacity",0).transition().duration(500).delay(700+15*(a-(r-25))).style("opacity",1).style("stroke-linecap","round").style("stroke",cEvents.title).style("stroke-width",o)})}),u.selectAll(".c1seasonMG").data(s).enter().append("g").attr("class","c1seasonMG").each(function(t,e){var a=e;d3.select(this).selectAll(".c1seasonM").data(t.seasons).enter().append("line").attr("class","c1seasonM").attr("x1",function(t){return c1x(t.season+.5)}).attr("x2",function(t){return c1x(t.season+1.5)}).attr("y1",function(t){return i(a)+c/2}).attr("y2",function(t){return i(a)+c/2}).style("stroke-linecap","round").style("stroke","rgba(0,0,0,0)").style("stroke-width",15).on("mouseover",function(t){(t.titles.length>0||t.finals.length>0||t.finalFours.length>0)&&tip.show(t),d3.selectAll(".sl-"+a).style("stroke","#3f3f3f"),d3.selectAll(".c1label").style("fill","#666"),d3.select("#c1l-"+a).style("fill","#b5b5b5")}).on("mouseout",function(t){d3.selectAll(".c1season").style("stroke","#444"),d3.selectAll(".c1label").style("fill","#b5b5b5"),tip.hide(t)})})}function r(t,e){var a=d3.select(".c1top").append("div").attr("class","chart1rowmain c1elements c1axisContainer"),r=a.append("svg").attr("class","c1axisSVG").attr("height",60).attr("width",o);r.selectAll(".c1tick").data(years).enter().append("line").attr("class","c1tick").attr("x1",function(t){return c1x(t)}).attr("x2",function(t){return c1x(t)}).attr("y1",0).attr("y2",73),r.selectAll(".c1axisRect").data(years2).enter().append("rect").attr("class","c1axisRect").attr("x",function(t){return c1x(t)-15}).attr("y",40).attr("width",30).attr("height",20).style("fill","#333"),r.selectAll(".c1axis").data(years2).enter().append("text").attr("class","c1axis").attr("x",function(t){return c1x(t)}).attr("y",55).text(function(t){return t})}function n(t,e,a,r,n){var c=0;n||(c=250),d3.selectAll(".searchRemove").remove();var o=t.filter(function(t){return camelize(t.metro)===camelize(e)})[0],l=d3.select(".c1axisSVG");l.call(tip);var i=40,u=d3.select(".c1axisContainer").append("div").attr("class","c1search");n&&(u.append("div").attr("class","searchicon").html('<i id="searchsubmit" class="fas fa-search"></i>'),u.append("div").attr("class","searchcity").html('<input type="text" id="c1search-bar" class="search-bar" placeholder ="'+o.metro+'" />'),$("#c1search-bar").easyAutocomplete(s)),l.selectAll(".searchSeason").data(o.seasons).enter().append("line").attr("class","searchSeason searchRemove").attr("x1",function(t){return c1x(o.seasons[0].season)}).attr("x2",function(t){return c1x(o.seasons[0].season)}).attr("y1",function(t){return 20}).attr("y2",function(t){return 20}).transition().duration(750).attr("x1",function(t){return c1x(t.season)}).attr("x2",function(t){return c1x(t.season+1.1)}).style("stroke-linecap","round").style("stroke","#444").style("stroke-width",5).each(function(t,e){var a=20,r=20,n=20,s=5;t.titles.length>0&&t.finals.length>0?(n=18.75,r=21.25,s=2.5):t.finals.length>0&&t.finalFours.length>0?(a=18.75,r=21.25,s=2.5):t.finals.length>0&&t.finalFours.length>0&&t.titles.length>0&&(a=18.3333,r=20,n=21.6667,s=1.6667);for(var c=0;c<t.finalFours.length;c++)l.selectAll("searchDataFF").data([t.season]).enter().append("line").attr("class","searchRemove searchData searchDataFF").attr("x1",function(t){return c1x(t)}).attr("x2",function(t){return c1x(t+.25)}).attr("y1",a).attr("y2",a).style("opacity",0).transition().duration(500).delay(700).style("opacity",1).style("stroke-linecap","round").style("stroke",cEvents.finalFour).style("stroke-width",s);for(var c=0;c<t.finals.length;c++)l.selectAll("searchDataF").data([t.season]).enter().append("line").attr("class","searchRemove searchData searchDataF").attr("x1",function(t){return c1x(t)}).attr("x2",function(t){return c1x(t+.25)}).attr("y1",r).attr("y2",r).style("opacity",0).transition().duration(500).delay(700).style("opacity",1).style("stroke-linecap","round").style("stroke",cEvents.final).style("stroke-width",s);for(var c=0;c<t.titles.length;c++)l.selectAll("searchDataT").data([t.season]).enter().append("line").attr("class","searchRemove searchData searchDataT").attr("x1",function(t){return c1x(t)}).attr("x2",function(t){return c1x(t+.25)}).attr("y1",n).attr("y2",n).style("opacity",0).transition().duration(500).delay(700).style("opacity",1).style("stroke-linecap","round").style("stroke",cEvents.title).style("stroke-width",s)}),l.selectAll(".searchM").data(o.seasons).enter().append("line").attr("class","searchM searchRemove").attr("y1",function(t){return 20}).attr("y2",function(t){return 20}).attr("x1",function(t){return c1x(t.season+.5)}).attr("x2",function(t){return c1x(t.season+1.5)}).style("stroke-linecap","round").style("stroke","rgba(0,0,0,0)").style("stroke-width",15).on("mouseover",function(t){(t.titles.length>0||t.finals.length>0||t.finalFours.length>0)&&tip.show(t),d3.selectAll(".searchSeason").style("stroke","#3f3f3f")}).on("mouseout",function(t){d3.selectAll(".searchSeason").style("stroke","#444"),tip.hide(t)})}var s={data:searchArray,list:{maxNumberOfElements:5,sort:{enabled:!0},match:{enabled:!0},onClickEvent:function(){u=$("#c1search-bar").val(),n(e,u,t,d,!1)},onKeyEnterEvent:function(){u=$("#c1search-bar").val(),n(e,u,t,d,!1)}}},c=15,o=$(".chart1").width()-c1m.right,l=25,i=d3.scaleBand(),u,d="seasons";e.forEach(function(t){searchArray.push(t.metro)}),t.forEach(function(t){t.seasonArray=parseArray(t.seasonArray)}),u=void 0!=userPlace?userPlace.metro:"Twin Cities, MN",d3.select(".chart1").append("div").attr("class","c1remove chart1row chart1rowMain").append("svg").attr("class","c1elementsSVG").attr("height",5).attr("width",o).selectAll(".c1tickmain").data(years).enter().append("line").attr("class","c1tickmain").attr("x1",function(t){return c1x(t)}).attr("x2",function(t){return c1x(t)}).attr("y1",0).attr("y2",0),$("#showMoreC1").on("click",function(){l+=25,a(e,t,d,l,!1),l>318&&d3.select("#showMoreC1").style("display","none")}),tip=d3.tip().attr("class","d3-tip").html(function(t){var e="",a="",r="";if(t.titles.length>0)var e="<h2 style='color:"+cEvents.title+"'>Titles</h2><p>"+t.titles+"</p>";if(t.finals.length>0)var a="<h2 style='color:"+cEvents.final+"'>Finals Appearance</h2><p>"+t.finals+"</p>";if(t.finalFours.length>0)var r="<h2 style='color:"+cEvents.finalFour+"'>Final Four Appearance</h2><p>"+t.finalFours+"</p>";return"<h1>"+t.season+"</h1>"+e+a+r}).direction("s").offset([25,0]),r(l,!0),n(e,u,t,d,!0),a(e,t,d,l,!0)}function drawChart2(t){function e(t,e,n){if("pro"===t){var s=d3.selectAll(".c2filter").append("div").attr("class","c2subfilter");s.append("span").attr("class","c2subOption c2subOptionActive").attr("key","pro").text("All");for(var c=0;c<d.professional.length;c++)s.append("span").attr("class","c2subOption").attr("key",e[c]).text(d.professional[c]);$(".c2subOption").click(function(){if($(".c2subOption").removeClass("c2subOptionActive"),$(this).addClass("c2subOptionActive"),t=$(this).attr("key"),"pro"===t&&$("#chart2headertext").text("Pro Sports"),"mlb"===t&&$("#chart2headertext").text("Pro Baseball"),
"nba"===t&&$("#chart2headertext").text("Pro Basketball"),"nfl"===t&&$("#chart2headertext").text("Pro Football"),"nhl"===t&&$("#chart2headertext").text("Pro Hockey"),"mls"===t&&$("#chart2headertext").text("Pro Soccer"),"cfl"===t&&$("#chart2headertext").text("Canadian Football"),d3.selectAll(".c2remove").remove(),"pro"!=t)var s=[t];if("pro"===t)var s=e;a(t,s,n),r(o,t,s,n,!1)})}if("ncaa"===t){var s=d3.selectAll(".c2filter").append("div").attr("class","c2subfilter");s.append("span").attr("class","c2subOption c2subOptionActive").attr("key","ncaa").text("All");for(var c=0;c<d.college.length;c++)s.append("span").attr("class","c2subOption").attr("key",e[c]).text(d.college[c]);$(".c2subOption").click(function(){if($(".c2subOption").removeClass("c2subOptionActive"),$(this).addClass("c2subOptionActive"),t=$(this).attr("key"),"ncaa"===t&&$("#chart2headertext").text("College Sports"),"ncaa-baseball-m"===t&&$("#chart2headertext").html("Men&rsquo;s College Baseball"),"ncaa-basketball-m"===t&&$("#chart2headertext").html("Men&rsquo;s College Basketball"),"ncaa-basketball-w"===t&&$("#chart2headertext").html("Women&rsquo;s College Basketball"),"ncaa-football-m"===t&&$("#chart2headertext").html("Men&rsquo;s College Football"),"ncaa-soccer-w"===t&&$("#chart2headertext").html("Women&rsquo;s College Soccer"),"ncaa-volleyball-w"===t&&$("#chart2headertext").html("Women&rsquo;s College Volleyball"),d3.selectAll(".c2remove").remove(),"ncaa"!=t)var s=[t];if("ncaa"===t)var s=e;a(t,s,n),r(o,t,s,n,!1)})}}function a(t,e,a){function r(t){$("#c2city").text(o[t].metro),$("#c2numTitles").text(o[t].titles),$("#c2numTeams").text(parseArray(o[t].teamList).length),d3.selectAll(".c2winListRow").remove();for(var e=0;e<parseArray(o[t].teamList).length;e++){var a=d3.select("#c2winList").append("div").attr("class","c2winListRow").text(parseArray(o[t].teamList)[e]);a.text().includes("MLB")&&a.style("color",cLeagues.mlb),a.text().includes("NBA")&&a.style("color",cLeagues.nba),a.text().includes("NFL")&&a.style("color",cLeagues.nfl),a.text().includes("NHL")&&a.style("color",cLeagues.nhl),a.text().includes("MLS")&&a.style("color",cLeagues.mls),a.text().includes("CFL")&&a.style("color",cLeagues.cfl),contains(a.text(),d.college)&&a.style("color",cLeagues.ncaa)}}var o=a.sort(function(e,a){return d3.descending(+e[t],+a[t])}).slice(0,10);r(0);var l=d3.max(o,function(e){return+e[t]});c=d3.scaleLinear().domain([0,74]);for(var i=0;i<o.length;i++){var u=d3.select(".chart2left").append("div").attr("class","c2remove chart2row chart2rowMain").attr("id","row"+i);u.on("mouseover",function(){d3.selectAll(".chart2rowMain").style("background-color","#333"),d3.select(this).style("background-color","#444"),r(d3.select(this).attr("id").replace("row",""))}),s=15,n=$(".chart2row").width()-225,c.range([1,n-15]);var y=i+1;i>0&&o[i][t]===o[i-1][t]&&(y=i),i>2&&o[i][t]===o[i-2][t]&&(y=i-1),i>4&&o[i][t]===o[i-3][t]&&(y=i-2),i>4&&o[i][t]===o[i-4][t]&&(y=i-3),u.append("div").attr("class","c2remove chart2rank").text(y),u.append("div").attr("class","c2remove chart2city").text(o[i].metro);for(var p=u.append("svg").attr("class","c2remove chart2svg").attr("height",s).attr("width",n),f=0;f<e.length;f++){for(var h=0,x=0;x<f;x++)o[i][e[x]]>0&&(h+=c(o[i][e[x]]));if(o[i][e[f]]>0){p.append("rect").attr("class","c2rect c2remove").attr("id","c2text"+camelize(o[i].metro)+"-"+camelize(e[f])).attr("x",h).attr("y",3).attr("height",s-3).attr("width",c(o[i][e[f]]-1)).style("fill","#333").style("stroke",function(){return"ncaa"===t?cLeagues.ncaa:cLeagues[e[f]]}).style("stroke-width",2).style("opacity",0).on("mouseover",function(t,e){d3.select(this).style("opacity",1),d3.selectAll("."+$(this).attr("id")).style("opacity",1)}).on("mouseout",function(){d3.select(this).style("opacity",0),d3.selectAll("."+$(this).attr("id")).style("opacity",0)});for(var m=0;m<o[i][e[f]];m++)p.append("rect").attr("class","c2ticks c2remove").attr("x",h+c(m)-2).attr("y",3).attr("width",2).attr("height",s-3).style("fill",function(){return"ncaa"===t?cLeagues.ncaa:cLeagues[e[f]]});e.length>1&&(p.append("text").attr("class","c2text c2remove chart2label c2text"+camelize(o[i].metro)+"-"+camelize(e[f])).attr("x",h).attr("y",0).attr("dy",-3).attr("dx",0).text(o[i][e[f]]+" ("+e[f]+")").style("fill","none").style("stroke","#333").style("stroke-width",4).style("stroke-linejoin","round").style("opacity",0),p.append("text").attr("class","c2text c2remove chart2label c2text"+camelize(o[i].metro)+"-"+camelize(e[f])).attr("x",h).attr("y",0).attr("dy",-3).attr("dx",0).text(o[i][e[f]]+" ("+e[f]+")").style("fill","#efefef").style("opacity",0))}}}}function r(t,e,a,r,o){d3.selectAll(".lastRemove").remove();var i=r.filter(function(e){return camelize(e.metro)===camelize(t)});if(!o&&($("#c2city").text(i[0].metro),$("#c2numTitles").text(i[0].titles),d3.selectAll(".c2winListRow").remove(),void 0!=parseArray(i[0].teamList))){$("#c2numTeams").text(parseArray(i[0].teamList).length);for(var u=0;u<parseArray(i[0].teamList).length;u++){var y=d3.select("#c2winList").append("div").attr("class","c2winListRow").text(parseArray(i[0].teamList)[u]);y.text().includes("MLB")&&y.style("color",cLeagues.mlb),y.text().includes("NBA")&&y.style("color",cLeagues.nba),y.text().includes("NFL")&&y.style("color",cLeagues.nfl),y.text().includes("NHL")&&y.style("color",cLeagues.nhl),y.text().includes("MLS")&&y.style("color",cLeagues.mls),y.text().includes("CFL")&&y.style("color",cLeagues.cfl),contains(y.text(),d.college)&&y.style("color",cLeagues.ncaa)}}var p=d3.select(".chart2left").append("div").attr("class","lastRemove chart2row c2remove chart2lastrow");p.append("div").attr("class","lastRemove c2remove chart2rank").html('<i id="searchsubmit" class="fas fa-search"></i>'),p.append("div").attr("class","lastRemove c2remove chart2city").html('<input type="text" id="search-bar" class="search-bar" placeholder="'+i[0].metro+'" />');var f=p.append("svg").attr("class","lastRemove c2remove chart2svg").attr("height",s).attr("width",n);$("#search-bar").easyAutocomplete(l);for(var h=0;h<a.length;h++){for(var x=0,m=0;m<h;m++)i[0][a[m]]>0&&(x+=c(i[0][a[m]]));if(i[0][a[h]]>0){f.append("rect").attr("class","c2rect c2remove").attr("id","c2text"+camelize(i[0].metro)+"-"+camelize(a[h])).attr("x",x).attr("y",3).attr("height",s-3).attr("width",c(i[0][a[h]]-1)).style("fill","#333").style("stroke",function(){return"ncaa"===e?cLeagues.ncaa:cLeagues[a[h]]}).style("stroke-width",2).style("opacity",0).on("mouseover",function(t,e){d3.select(this).style("opacity",1),d3.selectAll("."+$(this).attr("id")).style("opacity",1)}).on("mouseout",function(){d3.select(this).style("opacity",0),d3.selectAll("."+$(this).attr("id")).style("opacity",0)});for(var g=0;g<i[0][a[h]];g++)f.append("rect").attr("class","c2ticks c2remove").attr("x",x+c(g)-2).attr("y",3).attr("width",2).attr("height",s-3).style("fill",function(){return"ncaa"===e?cLeagues.ncaa:cLeagues[a[h]]});a.length>1&&(f.append("text").attr("class","c2text c2remove chart2label c2text"+camelize(i[0].metro)+"-"+camelize(a[h])).attr("x",x).attr("y",0).attr("dy",0).attr("dx",0).text(i[0][a[h]]+" ("+a[h]+")").style("fill","none").style("stroke","#444").style("stroke-width",4).style("opacity",0),f.append("text").attr("class","c2text c2remove chart2label c2text"+camelize(i[0].metro)+"-"+camelize(a[h])).attr("x",x).attr("y",0).attr("dy",0).attr("dx",0).text(i[0][a[h]]+" ("+a[h]+")").style("fill","#efefef").style("opacity",0))}}f.append("text").attr("class","c2remove chart2label").attr("x",c(i[0][e])).attr("y",3).attr("dy",9).attr("dx",7).text(i[0][e]).style("fill","#efefef")}var n,s,c,o,l={data:searchArray,list:{maxNumberOfElements:5,sort:{enabled:!0},match:{enabled:!0},onClickEvent:function(){o=$("#search-bar").val(),r(o,i,u[i],t,!1)},onKeyEnterEvent:function(){o=$("#search-bar").val(),r(o,i,u[i],t,!1)}}},i="titles",u={titles:["mlb","nba","nfl","nhl","mls","cfl","ncaa"],pro:["mlb","nba","nfl","nhl","mls","cfl"],ncaa:["ncaa_baseball_m","ncaa_basketball_m","ncaa_basketball_w","ncaa_football_m","ncaa_soccer_w","ncaa_volleyball_w"]},d={professional:["MLB","NBA","NFL","NHL","MLS","CFL"],college:["Baseball (M)","Basketball (M)","Basketball (W)","Football (M)","Soccer (W)","Volleyball (W)"]};o=void 0!=userPlace?userPlace.metro:"Twin Cities, MN",a(i,u[i],t),r(o,i,u[i],t,!0),$(".c2option").click(function(){$(".c2option").removeClass("c2optionActive"),$(this).addClass("c2optionActive"),i=$(this).attr("key"),"titles"===i&&$("#chart2headertext").text("Sports"),"pro"===i&&$("#chart2headertext").text("Pro Sports"),"ncaa"===i&&$("#chart2headertext").text("College Sports"),d3.selectAll(".c2remove").remove(),d3.selectAll(".c2subfilter").remove(),e(i,u[i],t),a(i,u[i],t),r(o,i,u[i],t,!0)})}function camelize(t){return t.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0==e?t.toLowerCase():t.toUpperCase()}).replace(/\s+/g,"")}function getRandomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}function Deg2Rad(t){return t*Math.PI/180}function PythagorasEquirectangular(t,e,a,r){t=Deg2Rad(t),a=Deg2Rad(a),e=Deg2Rad(e),r=Deg2Rad(r);var n=(r-e)*Math.cos((t+a)/2),s=a-t;return 6371*Math.sqrt(n*n+s*s)}function parseArray(t){return JSON.parse("["+t+"]")[0]}function findClosest(t){var e=99999,a;for(i=0;i<t.length;++i){var r=PythagorasEquirectangular(userCoord[0],userCoord[1],parseArray(t[i].lngLat)[1],parseArray(t[i].lngLat)[0]);r<e&&(a=i,e=r)}userPlace=t[a]}function contains(t,e){var a=0;return e.forEach(function(e){a+=t.includes(e)}),1===a}function ipLookUp(){$.ajax("http://ip-api.com/json").then(function t(e){userCoord.push(e.lat,e.lon)})}const container=d3.select("#scrolly-overlay"),stepSel=container.selectAll(".step");var userCoord=[],searchArray=[],userPlace,windowW,windowH,large_screen,medium_screen,small_screen,margin,c1m,scatterM,scatterD,c1d,w,c1x,scatterX,scatterY,swarmX,radius=d3.scaleLinear().range([3.5,20]),cLeagues={mlb:"#beaed4",cfl:"#7fc97f",mls:"#fdc086",nba:"#ffff99",nfl:"#f0027f",nhl:"#bf5b17",ncaa:"#386cb0",ncaa_baseball_m:"#386cb0",ncaa_basketball_m:"#386cb0",ncaa_basketball_w:"#386cb0",ncaa_football_m:"#386cb0",ncaa_soccer_w:"#386cb0",ncaa_volleyball_w:"#386cb0"},cEvents={title:"#f9ed35",final:"#a17bff",finalFour:"#fc545d"},years=[1870,1885,1900,1915,1930,1945,1960,1975,1990,2005,2020],years2=[1870,1900,1930,1960,1990,2020];loadData();