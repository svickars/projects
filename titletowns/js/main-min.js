function handleResize(){windowW=window.innerWidth,windowH=window.innerHeight,large_screen=!1,medium_screen=!1,small_screen=!1,windowW>=900?large_screen=!0:windowW>=650?medium_screen=!0:windowW<650&&(small_screen=!0),small_screen?(margin.left=0,margin.right=0,mapD.w=windowW-16,mapD.h=.66*windowW):(margin.left=.125*windowW-8,margin.right=.125*windowW-8,mapD.w=.75*windowW,mapD.h=.75*windowW*.66),projection=d3.geoAlbers().scale(mapD.w+100).translate([mapD.w/2,.6*mapD.h]).precision(.1),path=d3.geoPath().projection(projection),d3.selectAll("path").attr("d",path);for(var t=0;t<totalSvg;t++)d3.select("#map"+t).attr("height",mapD.h).attr("width",mapD.w).attr("transform","translate("+margin.left+")")}function loadData(){queue().defer(d3.json,"js/maps/world-continents.json").defer(d3.json,"js/maps/us.json").defer(d3.json,"js/maps/canada.json").defer(d3.csv,"data/data.csv").defer(d3.csv,"data/cities.csv").defer(d3.csv,"data/matrix.csv").await(processData)}function processData(t,e,r,a,n,o,l){handleResize(),window.addEventListener("resize",handleResize),drawMaps(e,r,a),small_screen&&drawMap0small(n),small_screen||drawMap0(n),drawMap1(n),detectView()}function drawMaps(t,e,r){for(var a=0;a<totalSvg;a++){var n=d3.select("#map"+a),o=n.append("g").attr("transform","translate("+mapD.m+","+mapD.m+")"),l=n.append("defs"),c=l.append("filter").attr("id","glow");c.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation","25").attr("result","blur"),c.append("feColorMatrix").attr("type","matrix").attr("values",".25 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.25 0 ").attr("result","bluralpha"),c.append("feOffset").attr("in","bluralpha").attr("dx",0).attr("dy",0).attr("result","offsetBlur");var i=c.append("feMerge");i.append("feMergeNode").attr("in","offsetBlur"),i.append("feMergeNode").attr("in","SourceGraphic"),o.append("path").attr("class","continent").datum(topojson.feature(t,t.objects.continent)).attr("d",path).style("fill","#fff").style("filter","url(#glow)")}}function detectView(){new ScrollMagic.Scene({triggerElement:"#map0"}).addTo(controller).on("enter",function(){map0||(map0=!0,$("#play-button").click())})}function drawMap0(t){function e(t){return t.id=t.id,t.date=d(t.date),t}function r(){n(g.invert(y)),(y+=h/151)>h&&(f=!1,y=0,clearInterval(timer),w.text("Play"))}function a(t){var e=l.selectAll(".city").data(t);e.enter().append("circle").attr("class","city").attr("cx",function(t){return c.select("."+t.trophySelector).transition().duration(250).attr("x",projection(parseCoord(t.t1coord))[0]-25).attr("y",projection(parseCoord(t.t1coord))[1]-25).style("opacity","1"),projection(parseCoord(t.t1coord))[0]}).attr("cy",function(t){return projection(parseCoord(t.t1coord))[1]}).style("fill",function(t){return t.colour}).style("opacity",function(t){return opacityScale(t.nth)/2}).attr("r",0).transition().duration(400).attr("r",function(t){return t.nth}),e.exit().remove(),c.selectAll(".trophy").style("opacity",0)}function n(e){j.attr("cx",g(e)),b.attr("transform","translate("+g(e)+")").style("left",margin.left+60+g(e)+"px").text(s(e)),a(t.filter(function(t){return t.year<=s(e)}))}for(var o=d3.select("#map0"),l=o.append("g").attr("transform","translate("+mapD.m+","+mapD.m+")"),c=o.append("g").attr("transform","translate("+mapD.m+","+mapD.m+")"),i=0;i<trophyList.length;i++)c.append("svg:image").attr("class","trophy trophy-"+trophyList[i]).attr("width",50).attr("height",50).attr("xlink:href","img/icons/"+trophyList[i]+".png").style("opacity",0);d3.select(".trophy-NBA").attr("x",projection([-75.1652215,39.9525839])[0]-25).attr("y",projection([-75.1652215,39.9525839])[1]-25),d3.select(".trophy-NHL").attr("x",projection([-79.3831843,43.653226])[0]-25).attr("y",projection([-79.3831843,43.653226])[1]-25),d3.select(".trophy-NFL").attr("x",projection([-81.378447,40.7989472999999])[0]-25).attr("y",projection([-81.378447,40.7989472999999])[1]-25),d3.select(".trophy-MLB").attr("x",projection([-71.0588801,42.3600825])[0]-25).attr("y",projection([-71.0588801,42.3600825])[1]-25),d3.select(".trophy-CFL").attr("x",projection([-79.3831843,43.653226])[0]-25).attr("y",projection([-79.3831843,43.653226])[1]-25),d3.select(".trophy-MLS").attr("x",projection([-77.0368707,38.9071923])[0]-25).attr("y",projection([-77.0368707,38.9071923])[1]-25),d3.select(".trophy-volleyball-w").attr("x",projection([-81.0348144,34.0007104])[0]-25).attr("y",projection([-81.0348144,34.0007104])[1]-25),d3.select(".trophy-baseball-m").attr("x",projection([-122.272747,37.8715926])[0]-25).attr("y",projection([-122.272747,37.8715926])[1]-25),d3.select(".trophy-basketball-m").attr("x",projection([-123.0867536,44.0520691])[0]-25).attr("y",projection([-123.0867536,44.0520691])[1]-25),d3.select(".trophy-basketball-w").attr("x",projection([-79.8742367999999,40.5077792])[0]-25).attr("y",projection([-79.8742367999999,40.5077792])[1]-25),d3.select(".trophy-football-m").attr("x",projection([-74.6672226,40.3572976])[0]-25).attr("y",projection([-74.6672226,40.3572976])[1]-25),d3.select(".trophy-soccer-w").attr("x",projection([-79.0558445,35.9131996])[0]-25).attr("y",projection([-79.0558445,35.9131996])[1]-25);var s=d3.timeFormat("%Y"),p=d3.timeFormat("%b %Y"),d=d3.timeParse("%m/%d/%y"),u=new Date(1870,0,1),m=new Date(2018,11,31),f=!1,y=30,h=mapD.w-100,w=d3.select("#play-button").style("left",margin.left+25+"px").style("top","25px"),g=d3.scaleTime().domain([u,m]).range([30,h]).clamp(!0),v=o.append("g").attr("class","slider").attr("transform","translate(60,50)");v.append("line").attr("class","track").attr("x1",g.range()[0]).attr("x2",g.range()[1]).select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","track-inset").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","track-overlay").call(d3.drag().on("start.interrupt",function(){v.interrupt()}).on("start drag",function(){y=d3.event.x,n(g.invert(y))})),v.insert("g",".track-overlay").attr("class","ticks").attr("transform","translate(60,-18)").selectAll("text").data(g.ticks(12)).enter().append("text").attr("x",g).attr("y",10).attr("text-anchor","middle").text(function(t){return parseInt(s(t))+10});var j=v.insert("circle",".track-overlay").attr("class","handle").attr("r",4).attr("cx",g(u)),x=d3.select("#firstMap"),b=x.append("div").attr("class","label").style("left",margin.left+60+g(u)+"px").style("top","25px").text(s(u));w.on("click",function(){var t=d3.select(this);"Pause"==t.text()?(f=!1,clearInterval(timer),t.text("Play"),$("#play-button").removeClass("played").addClass("paused")):(f=!0,timer=setInterval(r,100),t.text("Pause"),$("#play-button").removeClass("paused").addClass("played"))})}function drawMap0small(t){var e=t,r=[],a=d3.select("#map0"),n=a.append("g").attr("transform","translate("+mapD.m+","+mapD.m+")");d3.select("#play-button").style("display","none"),n.selectAll(".cityNFL").data(e).enter().append("circle").attr("class","cityNFL").attr("cx",function(t){return projection(parseCoord(t.t1coord))[0]}).attr("cy",function(t){return projection(parseCoord(t.t1coord))[1]}).style("fill",function(t){return t.colour}).style("opacity",function(t){var e=camelize(t.t1loc);r.push(e);var a=countThis(r,e);return opacityScale(a)/2}).attr("r",function(t){var e=camelize(t.t1loc);return r.push(e),countThis(r,e)/2})}function drawMap1(t){var e=t.filter(function(t){return"NCAA"===t.leagueLevel}),r=[];d3.select("#map1").append("g").attr("transform","translate("+mapD.m+","+mapD.m+")").selectAll(".cityNFL").data(e).enter().append("circle").attr("class","cityNFL").attr("cx",function(t){return projection(parseCoord(t.t1coord))[0]}).attr("cy",function(t){return projection(parseCoord(t.t1coord))[1]}).style("fill",function(t){return t.colour}).style("opacity",function(t){var e=camelize(t.t1loc);r.push(e);var a=countThis(r,e);return opacityScale(a)/2}).attr("r",function(t){var e=camelize(t.t1loc);return r.push(e),countThis(r,e)})}function camelize(t){return t.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0==e?t.toLowerCase():t.toUpperCase()}).replace(/\s+/g,"")}function countThis(t,e){var r=-1,a=-1;do{r++,a=t.indexOf(e,a+1)}while(a>=0);return r}function parseCoord(t){return JSON.parse("["+t+"]")[0]}var margin={top:0,right:0,bottom:0,left:0},mapD={w:0,h:0,m:8},totalSvg=2,large_screen=!1,medium_screen=!1,small_screen=!1,map0=!1,controller=new ScrollMagic.Controller,windowW,windowH,mapD,projection,path,trophyList=["NBA","NHL","NFL","MLB","CFL","MLS","volleyball-w","baseball-m","basketball-w","basketball-m","football-m","soccer-w"],opacityScale=d3.scaleLinear().domain([1,66]).range([.25,.05]);loadData();